# TrueNumber API Documentation

This document outlines the API routes and data structures for the TrueNumber mobile verification backend service.

## Overview

The TrueNumber API provides secure mobile number verification services for companies. The verification process involves three main endpoints that handle the complete verification flow.

## Base URL
```
https://api.truenumber.com/api/v1
```

## Authentication
All API requests require an API key to be included in the request headers:
```
Authorization: Bearer YOUR_API_KEY
```

## Endpoints

### 1. Initiate Verification Request

**Purpose:** A company's system calls this endpoint to start the verification process for a specific mobile number.

**Method:** `POST`  
**Path:** `/verification/initiate`

#### Request Body
```json
{
  "mobileNumber": "+1234567890",
  "companyId": "comp_abc",
  "requestId": "uuid_xyz"
}
```

**Field Descriptions:**
- `mobileNumber` (string, required): The mobile number to verify in E.164 format
- `companyId` (string, required): Unique identifier for the company making the request
- `requestId` (string, required): A unique ID generated by the company for internal tracking

#### Response Body

**Success Response (200):**
```json
{
  "status": "success",
  "message": "Verification initiated",
  "verificationId": "ver_12345",
  "deepLinkUrl": "truenumberapp://verify?number=+1234567890&verificationId=ver_12345"
}
```

**Error Response (400/500):**
```json
{
  "status": "error",
  "message": "Failed to initiate verification",
  "code": "INVALID_NUMBER"
}
```

**Error Codes:**
- `INVALID_NUMBER`: Mobile number format is invalid
- `COMPANY_NOT_FOUND`: Company ID is not registered
- `RATE_LIMIT_EXCEEDED`: Too many requests from this company
- `SYSTEM_ERROR`: Internal server error

---

### 2. Submit Verification Confirmation

**Purpose:** The TrueNumber mobile app calls this endpoint after the user confirms the number.

**Method:** `POST`  
**Path:** `/verification/submit`

#### Request Body
```json
{
  "verificationId": "ver_12345",
  "userConfirmedNumber": "+1234567890",
  "appUserId": "user_def_uuid"
}
```

**Field Descriptions:**
- `verificationId` (string, required): The verification ID received from the initiate endpoint
- `userConfirmedNumber` (string, required): The number the user saw and confirmed
- `appUserId` (string, required): A unique identifier for the user's app instance/device

#### Response Body

**Success Response (200):**
```json
{
  "status": "success",
  "message": "Mobile number verified successfully!",
  "verifiedAt": "2025-07-01T15:30:00Z"
}
```

**Error Response (400/500):**
```json
{
  "status": "failed",
  "message": "Verification failed: Number mismatch or session expired.",
  "code": "VERIFICATION_FAILED"
}
```

**Error Codes:**
- `SESSION_NOT_FOUND`: Verification session not found or expired
- `NUMBER_MISMATCH`: Confirmed number doesn't match the original
- `VERIFICATION_FAILED`: General verification failure
- `SESSION_EXPIRED`: Verification session has expired

---

### 3. Check Verification Status

**Purpose:** A company's system calls this endpoint to check the final status of a verification request.

**Method:** `GET`  
**Path:** `/verification/status/{verificationId}`

#### Path Parameters
- `verificationId` (string, required): The verification ID to check status for

#### Response Body

**Success Response (200):**
```json
{
  "verificationId": "ver_12345",
  "status": "verified",
  "mobileNumber": "+1234567890",
  "verifiedAt": "2025-07-01T15:30:00Z"
}
```

**Status Values:**
- `pending`: Verification is still in progress
- `verified`: Number has been successfully verified
- `failed`: Verification failed
- `expired`: Verification session has expired

**Error Response (404):**
```json
{
  "status": "error",
  "message": "Verification session not found",
  "code": "SESSION_NOT_FOUND"
}
```

---

## Data Models

### VerificationSession
```typescript
interface VerificationSession {
  verificationId: string;
  mobileNumber: string;
  companyId: string;
  requestId: string;
  status: 'pending' | 'verified' | 'failed' | 'expired';
  createdAt: string; // ISO 8601 timestamp
  verifiedAt?: string; // ISO 8601 timestamp (only if verified)
  appUserId?: string; // Set when verification is submitted
  expiresAt: string; // ISO 8601 timestamp
}
```

---

## Rate Limiting

- **Initiate Verification:** 100 requests per hour per company
- **Submit Verification:** 10 requests per minute per session
- **Status Check:** 1000 requests per hour per company

## Security Considerations

1. All verification sessions expire after 10 minutes
2. Mobile numbers are validated using E.164 format
3. All API requests require HTTPS
4. Rate limiting is enforced per company and endpoint
5. Verification IDs are cryptographically secure random strings

## Error Handling

All API responses follow a consistent error format:
```json
{
  "status": "error",
  "message": "Human-readable error message",
  "code": "MACHINE_READABLE_ERROR_CODE",
  "timestamp": "2025-07-01T15:30:00Z"
}
```

## Webhooks (Optional)

Companies can register webhook URLs to receive real-time verification status updates:

**Webhook Payload:**
```json
{
  "event": "verification.completed",
  "verificationId": "ver_12345",
  "status": "verified",
  "mobileNumber": "+1234567890",
  "verifiedAt": "2025-07-01T15:30:00Z",
  "companyId": "comp_abc",
  "requestId": "uuid_xyz"
}
```